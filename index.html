<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Watts > Wall Street: Robonomics made easy </title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root {
    --bg: #0e0e10;
    --card-bg: #1a1a1d;
    --text: #e0e0e0;
    --input-bg: #2c2c2f;
    --border: #444;
    --primary: #00ff9d;
    --primary-hover: #00cc7a;
    --preset-bg: #ff6b6b;
    --preset-hover: #ff5252;
    --live-bg: #4ecdc4;
    --highlight: #00ff9d;
    --table-header: #00ff9d;
    --table-header-text: #000;
  }
  [data-theme="light"] {
    --bg: #f5f5f5;
    --card-bg: #ffffff;
    --text: #1a1a1d;
    --input-bg: #f0f0f0;
    --border: #ccc;
    --primary: #00cc7a;
    --primary-hover: #00b368;
    --preset-bg: #ff5252;
    --preset-hover: #ff3333;
    --live-bg: #4ecdc4;
    --highlight: #00b368;
    --table-header: #00cc7a;
    --table-header-text: #fff;
  }
  body {
    font-family: Arial, Helvetica, sans-serif;
    background: var(--bg);
    color: var(--text);
    margin: 2.5rem;
    transition: background 0.3s, color 0.3s;
  }
  .card {
    background: var(--card-bg);
    border-radius: 10px;
    padding: 1.8rem;
    margin-bottom: 1.8rem;
    box-shadow: 0 4px 12px rgba(0,0,0,.6);
    transition: background 0.3s;
  }
  h1 { margin-top: 0; color: var(--primary); font-size: 1.8rem; }
  .tag {
    background: var(--primary);
    color: #000;
    padding: .3rem .7rem;
    border-radius: 4px;
    font-size: 0.8rem;
    margin-left: .5rem;
  }
  .instructions {
    background: rgba(0, 255, 157, 0.1);
    border-left: 4px solid var(--primary);
    padding: 1rem;
    margin: 1.5rem 0;
    font-size: 1rem;
    line-height: 1.6;
  }
  label { display: block; margin-top: 1.2rem; font-weight: 600; }
  input, select {
    width: 100%;
    padding: .6rem;
    background: var(--input-bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text);
    font-size: 1rem;
  }
  table { width: 100%; margin-top: 1.2rem; border-collapse: collapse; }
  th, td { border: 1px solid var(--border); padding: .6rem; text-align: left; }
  th {
    background: var(--table-header);
    color: var(--table-header-text);
    font-weight: bold;
  }
  button {
    margin-top: 1.5rem;
    padding: .7rem 1.5rem;
    background: var(--primary);
    color: #000;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }
  button:hover { background: var(--primary-hover); }
  .preset-btn {
    background: var(--preset-bg);
    color: #fff;
    padding: .5rem 1rem;
    border-radius: 6px;
    font-size: 0.9rem;
    margin-top: 1rem;
    display: inline-block;
    cursor: pointer;
    text-decoration: none;
    border: 0;
  }
  .live {
  background: #1a2a3a;
  color: #ffffff;
  padding: 1.2rem;
  border-radius: 10px;
  margin-top: 1.5rem;
  border-left: 4px solid #00ff9d;
  font-family: 'Courier New', monospace;
  font-size: 1rem;
}
[data-theme="light"] .live {
  background: #e6f7ff;
  color: #1a1a1d;
  border-left: 4px solid #00b368;
}
.live h3 {
  margin: 0 0 0.8rem;
  font-size: 1.1rem;
  color: #00ff9d;
}
[data-theme="light"] .live h3 {
  color: #00b368;
}
.live p {
  margin: 0.4rem 0;
  line-height: 1.5;
}
  .highlight { color: var(--highlight); font-weight: bold; }
  .theme-toggle {
    position: fixed;
    top: 1rem;
    right: 1rem;
    background: var(--card-bg);
    border: 1px solid var(--border);
    padding: .5rem 1rem;
    border-radius: 50px;
    cursor: pointer;
    font-size: 1.2rem;
    box-shadow: 0 2px 8px rgba(0,0,0,.3);
  }
  .exchange-box {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid var(--primary);
    border-radius: 8px;
    padding: 1rem;
    margin: 1.5rem 0;
    font-size: 0.95rem;
  }
 /* ðŸ”„ Auto-Update Indicator Animations */
#autoUpdateIndicator {
  opacity: 0;
  transition: opacity 0.6s ease;
}
#autoUpdateIndicator.visible {
  opacity: 1;
} 
</style>
</head>
<body>
<div class="theme-toggle" onclick="toggleTheme()" title="Toggle Light/Dark Mode">Moon/Sun</div>
<div class="card">
  <h1>Watts > Wall Street: Robonomics made easy âš¡<span class="tag">v6.3</span></h1>
  <div class="instructions">
    <strong>How to use:</strong><br>
    Fill in your robotic economy â†’ Click a preset or "Calculate" â†’ See your dividend by the day, second and year in both RT and USD.<br>
    <em>Try the Tesla Bot Factory below!</em>
  </div>

  <!-- Exchange Rate -->
  <div class="exchange-box">
    <label for="usdPerRT"><strong>Exchange Rate</strong></label>
    <div style="display:flex;gap:0.5rem;align-items:center;">
      <span style="white-space:nowrap;">1 RT =</span>
      <input id="usdPerRT" type="number" step="0.1" value="0.18" style="flex:1;">
      <span>USD</span>
    </div>
    <small>Default = average U.S. electricity cost (auto: $0.18 USD/kWh). Override as needed.</small>
  </div>

  <label for="brlas">Number of Contracts (BRLAs)</label>
  <input id="brlas" type="number" min="1" value="1" step="1">
  <label for="robots">Robots per Contract</label>
  <input id="robots" type="number" min="1" value="1" step="1">
  <label for="ttp">Robot Power (TTP per hour)</label>
  <input id="ttp" type="number" step="0.1" value="25.0">
  <label for="hours">Run Time (hours per contract)</label>
  <input id="hours" type="number" step="1" value="8760">
  <label for="gamble">Markup (torq_gamble)</label>
  <input id="gamble" type="number" step="0.1" min="1" value="3.0">
  <label for="itemsPerRobot">
    Items Made <em>per Robot</em>
  </label>
  <input id="itemsPerRobot" type="number" step="1" value="10" placeholder="e.g. 25 cars">
  <label for="populationValue">Population</label>
  <div style="display:flex;gap:0.5rem;">
    <input id="populationValue" type="number" value="350" step="1" style="flex:1;">
    <select id="populationUnit" style="flex:0.3;">
      <option value="1000000000">Billion People</option>
      <option value="1000000" selected>Million People</option>
      <option value="1000">Thousand People</option>
    </select>
  </div>
  <div class="preset-btn" onclick="loadTeslaPreset()">Tesla Bot Factory (200 bots, 1 year)</div>
  <button onclick="calc()" id="calcBtn">Calculate</button>
  <span id="autoUpdateIndicator" style="
    display:none;
    margin-left:1rem;
    font-weight:bold;
    color:var(--highlight);
    font-size:0.9rem;
    ">ðŸ”„ Auto-Update Active (update a field and tab out to auto-update)
  </span>
</div>

<div class="card" id="results" style="display:none">
  <h2>Results</h2>
  <table id="resultTable"></table>
  <div class="live">
    <h3>Live Minting</h3>
    <p><strong>Total GDP in RT per second:</strong> <span id="rtPerSec" class="highlight">0</span> RT/s</p>
    <p><strong>Total GDP in USD per second:</strong> <span id="usdPerSec" class="highlight">0</span> USD/s</p>
    <p><strong>Your dividend per second:</strong> <span id="divPerSec" class="highlight">0</span> RT/s (<span id="divUsdPerSec">0</span> USD/s)</p>
    <p><em>Thatâ€™s <span id="divPerDay" class="highlight">0</span> RT per day to your wallet (<span id="divUsdPerDay">0</span> USD/day).</em></p>
  </div>
  <button id="exportBtn" onclick="exportCSV()">Export CSV</button>
</div>
<script>
  // Constants
  const TOKEN_TORQ_PER_ROBO_TORQ = 3.6;
  // Default electricity cost (USD per kWh) â€” ~0.18 USD/kWh based on U.S. average
  const DEFAULT_USD_PER_KWH = 0.18;

  function toggleTheme() {
    const current = document.documentElement.getAttribute('data-theme') || 'dark';
    const next = current === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', next);
    localStorage.setItem('roboTorqTheme', next);
  }

  if (localStorage.getItem('roboTorqTheme') === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
  }

  function loadTeslaPreset() {
    document.getElementById('brlas').value = 1;
    document.getElementById('robots').value = 200;
    document.getElementById('ttp').value = 25;
    document.getElementById('hours').value = 8760;
    document.getElementById('gamble').value = 3;
    document.getElementById('itemsPerRobot').value = 25;
    document.getElementById('populationValue').value = 350;
    document.getElementById('populationUnit').value = 1000000;
    alert("Tesla Bot Factory loaded: 200 bots, 1 year, 25 items per robot");
  }

  function resetResults() {
  // Clear previous results so recalculation is clean
  document.getElementById('results').style.display = 'none';
  const tbl = document.getElementById('resultTable');
  tbl.innerHTML = '';
  document.getElementById('rtPerSec').textContent = '0';
  document.getElementById('usdPerSec').textContent = '0';
  document.getElementById('divPerSec').textContent = '0';
  document.getElementById('divUsdPerSec').textContent = '0';
  document.getElementById('divPerDay').textContent = '0';
  document.getElementById('divUsdPerDay').textContent = '0';
}

function calc() {
  resetResults(); // always start clean

  const brlas = parseFloat(document.getElementById('brlas').value) || 1;
  const robots = parseFloat(document.getElementById('robots').value) || 1;
  const ttp = parseFloat(document.getElementById('ttp').value) || 0;
  const hrs = parseFloat(document.getElementById('hours').value) || 0;
  const gamble = parseFloat(document.getElementById('gamble').value) || 1;
  const itemsPerRobot = parseFloat(document.getElementById('itemsPerRobot').value) || 0;
  const popValue = parseFloat(document.getElementById('populationValue').value) || 0;
  const popUnit = parseFloat(document.getElementById('populationUnit').value) || 1;
  const population = popValue * popUnit;
  let usdPerRT = parseFloat(document.getElementById('usdPerRT').value) || null;

  if (!usdPerRT || usdPerRT <= 0) {
    usdPerRT = DEFAULT_USD_PER_KWH;
    document.getElementById('usdPerRT').value = usdPerRT.toFixed(3);
  }

  if (brlas <= 0 || robots <= 0 || ttp <= 0 || hrs <= 0 || gamble <= 0 || itemsPerRobot <= 0 || population <= 0 || popValue <= 0) {
    alert("All values must be positive.");
    return;
  }

  const totalRobots = brlas * robots;
  const totalItems = totalRobots * itemsPerRobot;
  const fleetTTP = ttp * totalRobots;

  // Correct conversion: 1 RT = 1 kWh = (fleetTTP * hrs / 1000)
  const RoboTorq_in = (fleetTTP * hrs) / 1000;
  const MintingNeeded = RoboTorq_in * (gamble - 1);
  const Total_Value = RoboTorq_in + MintingNeeded;

  const inputs = [
    ["INPUT: Contracts", brlas, "contracts"],
    ["INPUT: Robots per Contract", robots, "robots"],
    ["INPUT: TTP per Robot", ttp.toFixed(2), "TokenTorq/hr"],
    ["INPUT: Run Time", hrs, "hours"],
    ["INPUT: Markup", gamble.toFixed(2), ""],
    ["INPUT: Items per Robot", itemsPerRobot, "items/robot"],
    ["INPUT: Population", population.toLocaleString(), "people"],
    ["INPUT: 1 RT =", usdPerRT.toFixed(3), "USD"],
    ["", "", ""]
  ];

  const outputs = [
    ["Total Robots", totalRobots, "robots"],
    ["Total Items", totalItems, "items"],
    ["Items per Contract", (totalItems / brlas).toFixed(2), "items/contract"],
    ["Total Power", fleetTTP.toFixed(2), "TokenTorq/hr"],
    ["Input Energy", RoboTorq_in.toFixed(2), "RoboTorq_in (kWh)"],
    ["New Value Minted", MintingNeeded.toFixed(2), "RoboTorq_minted"],
    ["Total Value", Total_Value.toFixed(2), "RoboTorq_out"]
  ];

  if (totalItems > 0) {
    const pricePerItem = Total_Value / totalItems;
    const pricePerItemUSD = pricePerItem * usdPerRT;
    outputs.push(["Price per Item", pricePerItem.toFixed(3), "RT"]);
    outputs.push(["Price per Item (USD)", pricePerItemUSD.toFixed(3), "USD"]);
  }

  const perCitizenRT = MintingNeeded / population;
  const perCitizenUSD = perCitizenRT * usdPerRT;
  outputs.push(["Your Dividend", perCitizenRT.toExponential(3), "RT/year"]);
  outputs.push(["Your Dividend (USD)", perCitizenUSD.toPrecision(5), "USD/year"]);

  // Live metrics
  const totalSeconds = hrs * 3600;
  const rtPerSecond = MintingNeeded / totalSeconds;
  const usdPerSecond = rtPerSecond * usdPerRT;
  const divPerSecondRT = rtPerSecond / population;
  const divPerSecondUSD = divPerSecondRT * usdPerRT;
  const divPerDayRT = divPerSecondRT * 86400;
  const divPerDayUSD = divPerSecondUSD * 86400;

  // Update live display
  document.getElementById('rtPerSec').textContent = rtPerSecond.toExponential(3);
  document.getElementById('usdPerSec').textContent = usdPerSecond.toExponential(3);
  document.getElementById('divPerSec').textContent = divPerSecondRT.toExponential(3);
  document.getElementById('divUsdPerSec').textContent = divPerSecondUSD.toExponential(3);
  document.getElementById('divPerDay').textContent = divPerDayRT.toExponential(3);
  document.getElementById('divUsdPerDay').textContent = divPerDayUSD.toPrecision(5);

  // Build results table
  const tbl = document.getElementById('resultTable');
  tbl.innerHTML = '<tr><th>Metric</th><th>Value</th><th>Unit</th></tr>';
  [...inputs, ...outputs].forEach(r => {
    const tr = document.createElement('tr');
    if (r[0].startsWith('INPUT:')) tr.style.background = '#2a2a2d';
    tr.innerHTML = `<td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td>`;
    tbl.appendChild(tr);
  });

  document.getElementById('results').style.display = 'block';
  document.getElementById('exportBtn').style.display = 'inline-block';
  window.resultData = [...inputs, ...outputs];

  // Optional: change button label
  const calcBtn = document.querySelector('button[onclick="calc()"]');
  calcBtn.textContent = "Recalculate";
}
window.addEventListener('DOMContentLoaded', () => {
  const input = document.getElementById('usdPerRT');
  if (!input.value || parseFloat(input.value) <= 0) {
    input.value = DEFAULT_USD_PER_KWH.toFixed(3);
  }
// ðŸ”„ Optional Live Auto-Recalculate + Fade Indicator
document.querySelectorAll('input, select').forEach(el => {
  el.addEventListener('change', () => {
    const resultsVisible = document.getElementById('results').style.display === 'block';
    if (resultsVisible) {
      calc();
      showAutoUpdateIndicator();
    }
  });
});

function showAutoUpdateIndicator() {
  const indicator = document.getElementById('autoUpdateIndicator');
  if (!indicator) return;
  indicator.style.display = 'inline';
  // Fade in
  requestAnimationFrame(() => {
    indicator.classList.add('visible');
  });
}

// Hide and fade out indicator when results are reset
function resetResults() {
  document.getElementById('results').style.display = 'none';
  const tbl = document.getElementById('resultTable');
  tbl.innerHTML = '';
  document.getElementById('rtPerSec').textContent = '0';
  document.getElementById('usdPerSec').textContent = '0';
  document.getElementById('divPerSec').textContent = '0';
  document.getElementById('divUsdPerSec').textContent = '0';
  document.getElementById('divPerDay').textContent = '0';
  document.getElementById('divUsdPerDay').textContent = '0';

  const indicator = document.getElementById('autoUpdateIndicator');
  if (indicator) {
    indicator.classList.remove('visible');
    // Fade out then hide completely
    setTimeout(() => {
      indicator.style.display = 'none';
    }, 600);
  }
}
});
</script>
</body>
</html>
